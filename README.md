# CRM-система для ломбарда

Веб-приложение на Python (Quart) для управления данными ломбарда.

## Описание

Система предназначена для автоматизации работы ломбарда и включает следующие функции:

- **Управление клиентами** - создание, редактирование и удаление клиентов
- **Учет займов** - оформление займов, отслеживание их статуса (активен, выплачен, просрочен)
- **Невостребованные товары** - автоматический учет товаров из просроченных займов
- **Продажи** - оформление продаж невостребованных товаров
- **Управление сотрудниками** - учет сотрудников, их должностей и прав доступа
- **Отчетность** - формирование квартальных отчетов и статистики

## Требования

- Python 3.8+
- PostgreSQL 12+
- pip

## Установка

1. Клонируйте репозиторий или скачайте проект

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте базу данных PostgreSQL:
```sql
CREATE DATABASE lombard_db;
```

4. Настройте подключение к базе данных:
   - Создайте файл `.env` в корне проекта
   - Укажите параметры подключения:
   ```
   DB_HOST=localhost
   DB_PORT=5432
   DB_USER=postgres
   DB_PASSWORD=password
   DB_NAME=lombard_db
   SECRET_KEY=your-secret-key-here
   FLASK_ENV=development
   ```
   
   Или используйте DATABASE_URL:
   ```
   DATABASE_URL=postgresql+asyncpg://username:password@localhost:5432/lombard_db
   SECRET_KEY=your-secret-key-here
   FLASK_ENV=development
   ```

5. Инициализируйте базу данных:
   ```bash
   python database/init_db.py
   ```
   
   Скрипт создаст все таблицы и заполнит их тестовыми данными:
   - 50 клиентов
   - 45 сотрудников
   - 25 процентов по займу
   - 250 займов
   - Автоматически созданные невостребованные товары из просроченных займов
   - Продажи

## Запуск приложения

### Через uvicorn (рекомендуется)
```bash
uvicorn app:app --host 0.0.0.0 --port 5000 --reload
```

Приложение будет доступно по адресу: http://localhost:5000

### Учетные данные по умолчанию
- **Логин**: admin
- **Пароль**: admin123

## Структура проекта

```
Vorobiev_CRM/
├── app.py                 # Основной файл приложения Quart
├── models.py              # Модели базы данных (SQLAlchemy)
├── config.py              # Конфигурация приложения
├── requirements.txt       # Зависимости Python
├── README.md             # Документация
├── .env                  # Файл конфигурации (создается вручную)
├── database/             # Скрипты для БД
│   └── init_db.py        # Скрипт инициализации БД
├── templates/            # HTML шаблоны (Jinja2)
│   ├── base.html
│   ├── index.html
│   ├── clients.html
│   ├── loans.html
│   ├── sales.html
│   ├── employees.html
│   └── reports.html
└── static/               # Статические файлы (CSS, JS)
```

## Структура базы данных

### Таблицы:

1. **Клиент** - информация о клиентах ломбарда (ID_Клиента, ФИО, Телефон)
2. **Сотрудник** - данные сотрудников (ID_Сотрудника, ФИО_Сотрудника, Должность, Дата_Приёма, Дата_Увольнения, Телефон_Сотрудника, Логин, Пароль)
3. **Процент_по_займу** - справочник процентов по займам (Индекс_процента, Состояние_товара, Срок_займа, Процент)
4. **Займ** - информация о выданных займах (Код_займа, Дата_займа, Клиент, Размер_займа, Процент_по_займу, Срок_займа, Статус_займа, Состояние_товара, Артикул_товара, Наименование_товара, Категория_товара, Физическое_состояние, Исполнитель)
5. **Невостребованный_товар** - товары из просроченных займов (Артикул, Займ, Оценочная_стоимость)
6. **Продажа** - информация о продажах (Код_продажи, Дата_продажи, Артикул_проданного_товара, Продавец)

## Основные функции

### Управление клиентами
- Добавление новых клиентов
- Редактирование данных клиентов
- Удаление клиентов
- Просмотр списка всех клиентов
- Поиск и фильтрация

### Управление займами
- Оформление новых займов с автоматическим расчетом артикула (равен коду займа)
- Автозаполнение полей товара при вводе
- Отслеживание статуса займов (активен, выплачен, просрочен)
- Автоматическое обновление статуса просроченных займов
- Просмотр детальной информации о займе
- Автоматический расчет процента по займу на основе состояния товара и срока

### Невостребованные товары
- Автоматическое создание товаров из просроченных займов
- Просмотр списка товаров, готовых к продаже
- Поиск и фильтрация

### Продажи
- Оформление продаж невостребованных товаров
- История всех продаж
- Поиск и фильтрация

### Управление сотрудниками
- Добавление новых сотрудников
- Редактирование данных сотрудников
- Увольнение сотрудников
- Просмотр списка сотрудников
- Система прав доступа на основе должностей

### Отчетность
- Квартальные отчеты по займам и продажам
- Статистика по статусам займов
- Визуализация данных (графики)

## Система прав доступа

Система поддерживает ролевую модель доступа:

- **Администратор** - полный доступ ко всем функциям
- **Менеджер-товаровед** - доступ к клиентам, займам, невостребованным товарам, продажам, отчетам
- **Оценщик-товаровед** - доступ к клиентам, займам, невостребованным товарам
- **Менеджер по продажам** - доступ к просмотру займов, невостребованным товарам, продажам, отчетам

## Автоматизация

- Автоматическое обновление статуса просроченных займов
- Автоматическое создание невостребованных товаров из просроченных займов
- Автоматический расчет артикула товара (равен коду займа)
- Автоматическое заполнение полей товара при вводе

## Технологии

- **Backend**: Quart (асинхронный Flask), SQLAlchemy (AsyncIO)
- **Database**: PostgreSQL
- **Frontend**: Bootstrap 5, Chart.js
- **Icons**: Bootstrap Icons
- **Authentication**: Quart-Auth

